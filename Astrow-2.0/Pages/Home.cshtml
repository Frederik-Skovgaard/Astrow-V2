@page "{handler?}"
@model IndexModel
@using Microsoft.AspNetCore.Http

@{
    ViewData["Title"] = "Home";
    Layout = "~/Pages/Shared/_Layout.cshtml";

    //Get start and end date of the user, for determining the min and max of the calendar input
    DateTime startTime = DateTime.Parse(HttpContext.Session.GetString("_StartDate"));
    DateTime endTime = DateTime.Parse(HttpContext.Session.GetString("_EndDate"));

    string startDate = startTime.ToString("yyyy-MM");
    string endDate = endTime.ToString("yyyy-MM");
}


<form method="post">
    <div class="TimeCard">
        <div class="container outer">
            <div class="row">
                <p>Dato: </p>
                <div class="DatePicker">
                    <input id="Calendar" value="@Model.CalendarValue" type="month" name="Calendar" class="form-control" min="@startDate" max="@endDate" required />
                    <button type="submit" asp-page-handler="Load" class="submitBTN">
                        <i class="fas fa-check"></i> Submit
                    </button>
                </div>


                @*one month back | Now | one month front*@
                <button type="submit" asp-page-handler="Back">
                    <i style="font-size: 25px;" class="fas fa-chevron-circle-left"></i>
                </button>
                <button type="submit" asp-page-handler="Now">
                    <i style="font-size: 25px;" class="fas fa-play-circle"></i>
                </button>
                <button type="submit" asp-page-handler="Forward">
                    <i style="font-size: 25px;" class="fas fa-chevron-circle-right"></i>
                </button>


            </div>
            <div class="Table-Head">
                <table>
                    <thead>
                        <tr>
                            <th class="DayTh" scope="col">Day</th>
                            <th class="DatoTh" scope="col">Dato</th>
                            <th class="FraværTh" scope="col">Fravær</th>
                            <th class="LoginTh" scope="col">Login</th>
                            <th class="LogudTh" scope="col">Logud</th>
                            <th class="SaldoTh" scope="col">Saldo</th>
                            <th class="TotSaldoTh" scope="col">Saldo+</th>
                        </tr>
                    </thead>
                </table>
            </div>

            <div class="Table-Gride">
                <table class="table">
                    <tbody>
                        @{
                            bool trigger = false;

                            string strClass = "";

                            //If list of days, day match the date of days date show date i guss
                            foreach (DateTime day in Model.Days)
                            {
                                if (day.ToString("yyyy/MM/dd") == DateTime.Now.ToString("yyyy/MM/dd"))
                                {
                                    strClass = "ToDayClass";
                                }

                                if (Model.daysList.Count != 0)
                                {
                                    //Foreach day in day list
                                    foreach (Model.Items.Days date in Model.daysList)
                                    {
                                        //If day is equal to day from days lists
                                        if (date.Date.ToString("yyyy/MM/dd") == day.ToString("yyyy/MM/dd"))
                                        {
                                            if (date.StartDay.ToString("HH:mm") == "00:00" && date.AbscenseID != 1)
                                            {
                                                Model.Items.AbscenseType abs = Model.AbscenseText.Find(x => x.ID == date.AbscenseID);
                                                
                                                <tr>
                                                    <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                                    <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                                    <td class="@strClass Fraværtr">@abs.Type</td>
                                                    <td class="@strClass Logintr">@date.StartDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Logudtr">@date.EndDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Saldotr">@date.Saldo</td>
                                                    <td class="@strClass TotSaldotr">@date.TotalSaldo</td>
                                                </tr>

                                                strClass = "";
                                                trigger = true;
                                            }
                                            else if (date.StartDay.ToString("HH:mm") == "00:00")
                                            {
                                                <tr>
                                                    <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                                    <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                                    <td class="@strClass Fraværtr"></td>
                                                    <td class="@strClass Logintr"></td>
                                                    <td class="@strClass Logudtr"></td>
                                                    <td class="@strClass Saldotr"></td>
                                                    <td class="@strClass TotSaldotr"></td>
                                                </tr>

                                                strClass = "";
                                                trigger = true;
                                            }
                                            //If date enday is equal too 00:00 load without end day
                                            else if (date.EndDay.ToString("HH:mm") == "00:00" && date.AbscenseID != 1)
                                            {
                                               Model.Items.AbscenseType abs = Model.AbscenseText.Find(x => x.ID == date.AbscenseID);
                                                
                                                <tr>
                                                    <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                                    <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                                    <td class="@strClass Fraværtr">@abs.Type</td>
                                                    <td class="@strClass Logintr">@date.StartDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Logudtr">@date.EndDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Saldotr">@date.Saldo</td>
                                                    <td class="@strClass TotSaldotr">@date.TotalSaldo</td>
                                                </tr>

                                                strClass = "";
                                                trigger = true;
                                            }
                                            else if (date.EndDay.ToString("HH:mm") == "00:00")
                                            {
                                                <tr>
                                                    <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                                    <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                                    <td class="@strClass Fraværtr"></td>
                                                    <td class="@strClass Logintr">@date.StartDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Logudtr"></td>
                                                    <td class="@strClass Saldotr">-7:24 </td>
                                                    <td class="@strClass TotSaldotr">@date.TotalSaldo</td>
                                                </tr>

                                                strClass = "";
                                                trigger = true;
                                            }
                                            else
                                            {
                                                <tr>
                                                    <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                                    <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                                    <td class="@strClass Fraværtr"></td>
                                                    <td class="@strClass Logintr">@date.StartDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Logudtr">@date.EndDay.ToString("HH:mm")</td>
                                                    <td class="@strClass Saldotr">@date.Saldo</td>
                                                    <td class="@strClass TotSaldotr">@date.TotalSaldo</td>
                                                </tr>

                                                strClass = "";

                                                trigger = true;
                                            }
                                        }
                                    }

                                    //Need if too get rid of repets
                                    if (trigger == true)
                                    {
                                        trigger = false;
                                    }
                                    else if (day.ToString("dddd") == "lørdag" || day.ToString("dddd") == "søndag")
                                    {
                                        <tr>
                                            <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                            <td class="WeekdEnd @strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                            <td class="WeekdEnd @strClass Fraværtr"></td>
                                            <td class="WeekdEnd @strClass Logintr"></td>
                                            <td class="WeekdEnd @strClass Logudtr"></td>
                                            <td class="WeekdEnd @strClass Saldotr"></td>
                                            <td class="WeekdEnd @strClass TotSaldotr"></td>
                                        </tr>

                                        strClass = "";
                                    }
                                    else
                                    {
                                        <tr>
                                            <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                            <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                            <td class="@strClass Fraværtr"></td>
                                            <td class="@strClass Logintr"></td>
                                            <td class="@strClass Logudtr"></td>
                                            <td class="@strClass Saldotr"></td>
                                            <td class="@strClass TotSaldotr"></td>
                                        </tr>

                                        strClass = "";
                                    }

                                }
                                else if (day.ToString("dddd") == "lørdag" || day.ToString("dddd") == "søndag")
                                {
                                    <tr>
                                        <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                        <td class="WeekdEnd @strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                        <td class="WeekdEnd @strClass Fraværtr"></td>
                                        <td class="WeekdEnd @strClass Logintr"></td>
                                        <td class="WeekdEnd @strClass Logudtr"></td>
                                        <td class="WeekdEnd @strClass Saldotr"></td>
                                        <td class="WeekdEnd @strClass TotSaldotr"></td>
                                    </tr>

                                    strClass = "";
                                }
                                else
                                {
                                    <tr>
                                        <th scope="row" class="Dayth">@day.ToString("dddd")  </th>
                                        <td class="@strClass Datetr">@day.ToString("yyyy-MM-dd")</td>
                                        <td class="@strClass Fraværtr"></td>
                                        <td class="@strClass Logintr"></td>
                                        <td class="@strClass Logudtr"></td>
                                        <td class="@strClass Saldotr"></td>
                                        <td class="@strClass TotSaldotr"></td>
                                    </tr>

                                    strClass = "";
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</form>
