@page "{handler?}/{id?}"
@model Astrow_2._0.Pages.AdminPage.Fraværes_AnmodningerModel
@{
    ViewData["Title"] = "Anmodninger | Page";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<form method="post">
    <div class="AdminPage">
        <div class="AdminNavBTN" id="AdminNavBTN">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
            </svg>
        </div>

        <div class="container">
            <div class="AdminNav">
                <div class="row upper-row" id="AdminNav">
                    <a href="/AdminPage/Opret-Bruger" class="btn btn-lg btn-secondary">
                        <i class="fas fa-plus-circle"></i> Opret bruger
                    </a>
                    <a href="/AdminPage/Opdater-Bruger" class="btn btn-lg btn-secondary">
                        <i class="fas fa-user-edit"></i> Opdater bruger
                    </a>
                    <a href="/AdminPage/Opdater-Timekort" class="btn btn-lg btn-secondary">
                        <i class="fas fa-user-clock"></i> Opdater Timekort
                    </a>
                    <a href="/AdminPage/Brugere" class="btn btn-lg btn-secondary">
                        <i class="fas fa-users"></i> Brugere
                    </a>
                    <a href="/AdminPage/Fraværes-Anmodninger" class="btn btn-lg btn-primary bottom">
                        <i class="fa-solid fa-calendar-day"></i> Anmodniger
                    </a>
                </div>
            </div>
            <div class="container lower-container AbscenseRequest">
                <div class="row col-row">
                    <div class="box">
                        <div class="col-2">
                            <h3>Anmodninger</h3>
                        </div>
                        <div class="col-3">
                            <input autocomplete="off" type="text" class="form-control" id="myInput" onkeyup="SearchFunction()" placeholder="Søg efter navn..." title="Type in a name">
                        </div>
                    </div>
                    <div class="Table-Gride">
                        <ul id="myUL">
                            @foreach (Model.Items.Request requests in Model.Requests)
                            {

                                Model.Containers.PersonalInfo user = Model.People.Find(x => x.ID == requests.UserID);
                                Model.Items.AbscenseType abscencseType = Model.AbscensesRequest.Find(x => x.ID == requests.AbsID);

                                string middleName = "";

                                if (user.MiddleName != "")
                                {
                                    middleName = $"{user.MiddleName.Substring(0, 1).ToUpper()}.";
                                }

                                <li>
                                    <div class="row col-row RequestTable">
                                        <div class="col-6 Delete-Col">
                                            <label class="UserLabel">@user.FirstName @middleName @user.LastName.Substring(0, 1).ToUpper().</label>
                                            <p>@abscencseType.Type</p>
                                        </div>
                                        <div class="col-6 col-btn">
                                            <input id="ID" asp-for="ID" hidden />

                                            <input onclick="MyTemp(@requests.RequestID)" type="submit" class="btn btn-primary btn-Request" value="Godkend" asp-page-handler="Accept" />
                                            <input onclick="MyTemp(@requests.RequestID)" type="submit" class="btn btn-danger btn-Request" value="Afvis" asp-page-handler="Deny" />
                                            <input onclick="MyTemp(@requests.RequestID)" type="button" class="btn btn-secondary btn-Request" value="Info" data-toggle="modal" data-target="#InfoModal @requests.RequestID" />
                                        </div>
                                    </div>
                                </li>

                                <!-- Modal -->
                                <div class="modal fade" id="InfoModal @requests.RequestID" tabindex="-1" role="dialog" aria-labelledby="InfoModal" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">@user.FirstName @user.MiddleName.Substring(0, 1).ToUpper(). @user.LastName.Substring(0, 1).ToUpper().</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row col-row">
                                                    <div class="col-6 TextCol">
                                                        <label>@abscencseType.Type</label>
                                                    </div>
                                                </div>
                                                @if (requests.Text != "")
                                                {
                                                    <div class="row col-row">
                                                        <div class="col-6 TextCol">
                                                            <textarea readonly type="text" class="form-control AbsenceText" name="AbscText">@requests.Text</textarea>
                                                        </div>
                                                    </div>
                                                }

                                                <div class="row col-row">
                                                    @if (requests.SecDate.ToString("HH:mm") == "00:00")
                                                    {
                                                        <div class="col-6">
                                                            <p type="text" class="form-control">@requests.Date.ToString("dd-MM-yyyy HH:mm")</p>
                                                        </div>

                                                    }
                                                    else
                                                    {
                                                        <div class="col-6">
                                                            <p class="form-control">@requests.Date.ToString("dd-MM-yyyy HH:mm")</p>
                                                        </div>
                                                        <div class="col-6">
                                                            <p class="form-control">@requests.SecDate.ToString("dd-MM-yyyy HH:mm")</p>
                                                        </div>
                                                    }

                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <input type="button" class="btn btn-secondary" data-dismiss="modal" value="Close" />
                                                <input type="submit" class="btn btn-primary" value="Godkend" asp-page-handler="Accept" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
    function MyTemp(id, user) {
        document.getElementById("ID").value = id;
        document.getElementById("UserID").value = user;
    }
</script>

<script type="text/javascript">
    //Make Admin Nav apper and disapper, Magic!
    $('#AdminNavBTN').click(function() {
        $('#AdminNav').toggleClass("show")
    });

    function SearchFunction() {
        var input, filter, ul, li, a, i, txtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        ul = document.getElementById("myUL");
        li = ul.getElementsByTagName("li");
        for (i = 0; i < li.length; i++) {
            a = li[i].getElementsByTagName("label")[0];
            txtValue = a.textContent || a.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }
</script>


<!--#region FraværesAnmodning  -->
    <!-- Modal -->
    <form method="post">
        <div class="modal fade" id="AbscenseRequest" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Fraværsanmodning</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row col-row">
                            <div class="col-6 Abscense">
                                <select class="form-control AbscenseTypeDrop" asp-for="AbsenceType" name="AbsenceType" id="AbscenseDrop">
                                    @{
                                        foreach (Model.Items.AbscenseType type in Model.AbscensesRequest)
                                        {
                                            <option value="@type.ID">@type.Type</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row col-row TextRow">
                            <div class="col-6 TextCol">
                                <textarea type="text" class="form-control AbsenceText" name="AbscText" placeholder="* Valgfrit Fraværes oversag" asp-for="AbscText"></textarea>
                            </div>
                        </div>
                        <div class="row col-row Date" id="Date">
                            <div class="col-6 Calendar">
                                <input id="AbsCalendar" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCal" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Vælge en dato')" oninput="this.setCustomValidity('')" required />
                            </div>
                            <div class="col-2 Hour">
                                <input class="HourClock" id="HourClock" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="Hour" required>
                            </div>
                        </div>
                        <div class="TwoDates" id="TwoDatesDiv">
                            <div class="row col-row Date">
                                <div class="col-6">
                                    <input id="AbsCalendarTwo" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalTwo" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv start dato her')" oninput="this.setCustomValidity('')" />
                                </div>
                                <div class="col-6">
                                    <input id="AbsCalendarThree" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalThree" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv end dato her')" oninput="this.setCustomValidity('')" />
                                </div>
                            </div>
                            <div class="row col-row Clock">
                                <div class="col-6 TwoDate">
                                    <input class="HourClockTwo" id="HourTwo" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="HourTwo">
                                </div>
                                <div class="col-6 TwoDate">
                                    <input class="HourClockTwo" id="HourThree" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="HourThree">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input value="1" id="Bit" asp-for="Bit" hidden />
                        <input type="button" id="TwoDates" class="btn btn-secondary" value="Længer period" />
                        <input type="button" class="btn btn-secondary" data-dismiss="modal" value="Close" />
                        <input type="submit" id="submit" class="btn btn-primary" asp-page-handler="AbscenseRequest" value="Save changes" />
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script type="text/javascript">
        $('#TwoDates').click(function() {
            $('.TwoDates').toggleClass("show");
            $('#Date').toggleClass("Hide");

            if (document.getElementById('AbsCalendar').hasAttribute("Required")) {
                document.getElementById('Bit').setAttribute('value','2')

                $('#AbsCalendar').prop('required',false);
                $('#HourClock').prop('required',false);

                $('#AbsCalendarTwo').prop('required',true);
                $('#AbsCalendarThree').prop('required',true);
                $('#HourTwo').prop('required',true);
                 $('#HourTwo').attr('min', '8');

                $('#HourThree').prop('required',true);
                $('#HourThree').attr('min', '8');
            }
            else {
                document.getElementById('Bit').setAttribute('value','1')

                $('#AbsCalendar').prop('required',true);
                $('#HourClock').prop('required',true);

                $('#AbsCalendarTwo').prop('required',false);
                $('#AbsCalendarThree').prop('required',false);

                $('#HourTwo').prop('required',false);
                $('#HourTwo').removeAttr('min');

                $('#HourThree').prop('required',false);
                $('#HourThree').removeAttr('min');
            }
        });

        $('#submit').click(function() {
            if (document.getElementById('AbscenseRequest').classList.contains("show")) {

                $('#FirstName').prop('required',false);
                $('#LastName').prop('required',false);
                $('#UserName').prop('required',false);
                $('#Password').prop('required',false);
                $('#StartDate').prop('required',false);
                $('#EndDate').prop('required',false);

            }
            else {

                $('#FirstName').prop('required',true);
                $('#LastName').prop('required',true);
                $('#UserName').prop('required',true);
                $('#Password').prop('required',true);
                $('#StartDate').prop('required',true);
                $('#EndDate').prop('required',true);
            }

            if (document.getElementById('TwoDatesDiv').classList.contains("show")) {
                var currentStartTimeValue = document.getElementById("HourTwo").value;
                var currentEndTimeValue = document.getElementById("HourThree").value;

                var currentStartDateValue = document.getElementById("AbsCalendarTwo").value;
                var currentEndDateValue = document.getElementById("AbsCalendarThree").value;

                if (!currentStartTimeValue) {
                    alert('Vægle en start tid!');
                    return false;
                }
                else if (!currentEndTimeValue) {
                    alert('Vægle en slut tid!');
                    return false;
                }
                else if (currentStartTimeValue >= currentEndTimeValue || currentStartDateValue > currentEndDateValue) {
                    if(currentStartDateValue >= currentEndDateValue){
                        alert('Slut tiden må ikke være før start tiden!');
                        return false;
                    }
                }

                document.getElementById('submit').style.pointerEvents = "none";
        }
        });

        document.getElementById('AbsCalendarTwo').onchange = function () {
            var input = document.getElementById('AbsCalendarThree');
            var otherInput = document.getElementById('AbsCalendarTwo').value;
            input.setAttribute("min", otherInput)
        }

    </script>
<!--#endregion -->