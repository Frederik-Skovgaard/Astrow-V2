@page "{handler?}"
@model Astrow_2._0.Pages.AdminPage.UpdateUserModel
@{
    ViewData["Title"] = "Opdater | Page";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}


<div class="AdminPage">
    <button class="AdminNavBTN" id="AdminNavBTN">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
        </svg>
    </button>

    <div class="container">
        <div class="AdminNav">
            <div class="row upper-row" id="AdminNav">
                <a href="/AdminPage/Opret-Bruger" class="btn btn-lg btn-primary">
                    <i class="fas fa-plus-circle"></i> Opret bruger
                </a>
                <a href="/AdminPage/Opdater-Bruger" class="btn btn-lg btn-secondary">
                    <i class="fas fa-user-edit"></i> Opdater bruger
                </a>
                <a href="/AdminPage/Opdater-Timekort" class="btn btn-lg btn-secondary">
                    <i class="fas fa-user-clock"></i> Opdater Timekort
                </a>
                <a href="/AdminPage/Brugere" class="btn btn-lg btn-secondary">
                    <i class="fas fa-users"></i> Brugere
                </a>
            </div>
        </div>
        <div class="container lower-container UpdateUser">
            <div class="row col-row">
                <div class="col-12">

                    <label>Users</label> <br />
                    <div class="dropdown">
                        <button class="btn btn-p dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Users
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            @foreach (Model.Containers.Users user in Model.UserList)
                            {
                                @*Dropdown with every user*@
                                <form asp-page-handler="User" method="post">
                                    <input asp-for="ID" value="@user.User_ID" hidden />
                                    <input class="dropdown-item" type="submit" asp-page-handler="User" id="usernbtn" value="@user.UserName" />
                                </form>
                            }
                        </div>
                    </div>

                </div>
            </div>

            @*Update user*@
            <form asp-page-handler="UpdateUser" method="post">
                <div class="row col-row">
                    <div class="col-4">
                        <label>Fornavn</label> <br />

                        <input autocomplete="off" required asp-for="FirstName" id="FirstName" type="text" placeholder="Fornavn" class="form-control" oninvalid="this.setCustomValidity('Skriv fornavn her')" oninput="this.setCustomValidity('')" />
                        <span asp-validation-for="FirstName" class="CreateUserError"></span>
                    </div>

                    <div class="col-4">
                        <label>Mellemnavn</label> <br />

                        <input autocomplete="off" asp-for="MiddleName" id="MiddleName" type="text" placeholder="Mellemnavn" class="form-control" />
                        <span asp-validation-for="MiddleName" class="CreateUserError"></span>
                    </div>

                    <div class="col-4">
                        <label>Efternavn</label> <br />

                        <input autocomplete="off" required asp-for="LastName" id="LastName" type="text" placeholder="Efternavn" class="form-control" oninvalid="this.setCustomValidity('Skriv efternavn her')" oninput="this.setCustomValidity('')" />
                        <span asp-validation-for="LastName" class="CreateUserError"></span>
                    </div>
                </div>

                <div class="row col-row">
                    <div class="col-6">
                        <label>Brugernavn</label> <br />

                        <input autocomplete="off" required asp-for="UserName" id="UserName" type="text" placeholder="Brugernavn" class="form-control" oninvalid="this.setCustomValidity('Skriv brugernavn her')" oninput="this.setCustomValidity('')" />
                        <span asp-validation-for="UserName" class="CreateUserError"></span>
                    </div>

                    <div class="col-6">
                        <label>Kodeord</label> <br />

                        <input autocomplete="off" asp-for="Password" id="Password" type="password" placeholder="Kodeord" autocomplete="off" class="form-control" />
                        <span asp-validation-for="Password" class="CreateUserError"></span>
                    </div>
                </div>

                <div class="row col-row">
                    <div class="col-6">
                        <label>Start Dato</label> <br />

                        <input asp-for="StartDate" required id="StartDate" type="date" autocomplete="off" class="form-control" oninvalid="this.setCustomValidity('Skriv start dato her')" oninput="this.setCustomValidity('')" />
                        <span asp-validation-for="StartDate" class="CreateUserError"></span>
                    </div>

                    <div class="col-6">
                        <label>Slut Dato</label> <br />

                        <input asp-for="EndDate" required id="EndDate" type="date" autocomplete="off" class="form-control" oninvalid="this.setCustomValidity('Skriv slut dato her')" oninput="this.setCustomValidity('')" />
                        <span asp-validation-for="EndDate" class="CreateUserError"></span>
                    </div>

                    <div class="row col-row">
                        <div class="col-12">
                            <label>Rolle</label> <br />

                            <select name="Role" asp-for="Role" id="Role" class="form-control">
                                <option value="Elev">Elev</option>
                                <option value="Instructør">Instructør</option>
                            </select>
                            <span asp-validation-for="Role" class="CreateUserError"></span>

                        </div>
                    </div>
                </div>

                <div class="row submit-row">
                    @if (@Model.Bool != false)
                    {
                        <input type="submit" asp-page-handler="UpdateUser" asp-route-id="@Model.ID" id="SubmitUser" class="btn btn-lg btn-primary" value="Submit" />
                    }
                    else
                    {
                        <input type="submit" asp-page-handler="UpdateUser" asp-route-id="@Model.ID" id="SubmitUser" class="btn btn-lg btn-primary" value="Submit" disabled />
                    }
                </div>

<!--#region FraværesAnmodning  -->
                <!-- Modal -->
                <div class="modal fade" id="AbscenseRequest" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Fraværsanmodning</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row col-row">
                                    <div class="col-6 Abscense">
                                        <select class="form-control AbscenseTypeDrop" asp-for="AbsenceType" name="AbsenceType" id="AbscenseDrop">
                                            @{
                                                foreach (Model.Items.AbscenseType type in Model.Abscenses)
                                                {
                                                    <option value="@type.ID">@type.Type</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="row col-row TextRow">
                                    <div class="col-6 TextCol">
                                        <textarea type="text" class="form-control AbsenceText" name="AbscText" placeholder="* Valgfrit Fraværes oversag" asp-for="AbscText"></textarea>
                                    </div>
                                </div>
                                <div class="row col-row Date" id="Date">
                                    <div class="col-6 Calendar">
                                        <input id="AbsCalendar" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCal" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Vælge en dato')" oninput="this.setCustomValidity('')" required />
                                    </div>
                                    <div class="col-2 Hour">
                                        <input class="HourClock" value="@DateTime.Now.ToString("hh:mm")" min="08:00" max="15:24" type="time" name="Hour" required>
                                    </div>
                                </div>
                                <div class="TwoDates" id="TwoDatesDiv">
                                    <div class="row col-row Date">
                                        <div class="col-6">
                                            <input id="AbsCalendarTwo" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalTwo" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv start dato her')" oninput="this.setCustomValidity('')" />
                                        </div>
                                        <div class="col-6">
                                            <input id="AbsCalendarThree" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalThree" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv end dato her')" oninput="this.setCustomValidity('')" />
                                        </div>
                                    </div>
                                    <div class="row col-row Clock">
                                        <div class="col-6 TwoDate">
                                            <input class="HourClockTwo" id="HourTwo" value="@DateTime.Now.ToString("hh:mm")" min="08:00" max="15:24" type="time" name="HourTwo">
                                        </div>
                                        <div class="col-6 TwoDate">
                                            <input class="HourClockTwo" id="HourThree" value="@DateTime.Now.ToString("hh:mm")" min="08:00" max="15:24" type="time" name="HourThree">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <input value="1" id="Bit" asp-for="Bit" hidden />
                                <input type="button" id="TwoDates" class="btn btn-secondary" value="Længer period" />
                                <input type="button" class="btn btn-secondary" data-dismiss="modal" value="Close" />
                                <input type="submit" id="submit" class="btn btn-primary" asp-page-handler="AbscenseRequest" value="Save changes" />
                            </div>
                        </div>
                    </div>
                </div>

                <script type="text/javascript">
                    $('#TwoDates').click(function() {
                        $('.TwoDates').toggleClass("show");
                        $('#Date').toggleClass("Hide");

                        if (document.getElementById('AbsCalendar').hasAttribute("Required")) {
                            document.getElementById('Bit').setAttribute('value','2')

                            $('#AbsCalendar').prop('required',false);
                            $('.HourClock').prop('required',false);

                            $('#AbsCalendarTwo').prop('required',true);
                            $('#AbsCalendarThree').prop('required',true);
                            $('.HourClockTwo').prop('required',true);
                        }
                        else {
                            document.getElementById('Bit').setAttribute('value','1')

                            $('#AbsCalendar').prop('required',true);
                            $('.HourClock').prop('required',true);

                            $('#AbsCalendarTwo').prop('required',false);
                            $('#AbsCalendarThree').prop('required',false);
                            $('.HourClockTwo').prop('required',false);
                        }
                    });


                    $('#submit').click(function() {
                        if (document.getElementById('AbscenseRequest').classList.contains("show")) {

                            $('#FirstName').prop('required',false);
                            $('#LastName').prop('required',false);
                            $('#UserName').prop('required',false);
                            $('#Password').prop('required',false);
                            $('#StartDate').prop('required',false);
                            $('#EndDate').prop('required',false);
                        }
                        else {

                            $('#FirstName').prop('required',true);
                            $('#LastName').prop('required',true);
                            $('#UserName').prop('required',true);
                            $('#Password').prop('required',true);
                            $('#StartDate').prop('required',true);
                            $('#EndDate').prop('required',true);
                        }
                });

                    document.getElementById('AbsCalendarTwo').onchange = function () {
                        var input = document.getElementById('AbsCalendarThree');
                        var otherInput = document.getElementById('AbsCalendarTwo').value;
                        input.setAttribute("min", otherInput)
                    }

                    $('#submit').click(function () {
                        if (document.getElementById('TwoDatesDiv').classList.contains("show")) {
                            var currentStartTimeValue = document.getElementById("HourTwo").value;
                            var currentEndTimeValue = document.getElementById("HourThree").value;

                            if (!currentStartTimeValue) {
                                alert('Vægle en start tid!');
                                    return false;
                            }
                            else if (!currentEndTimeValue) {
                                alert('Vægle en slut tid!');
                                    return false;
                            }
                            else if (currentStartTimeValue >= currentEndTimeValue) {
                                alert('Slut tiden må ikke være før start tiden!');
                                    return false;
                            }
                        }
                    });


                    $("#EndDate").change(function () {
                        var startDate = document.getElementById("StartDate").value;
                        var endDate = document.getElementById("EndDate").value;

                        if ((Date.parse(endDate) <= Date.parse(startDate))) {
                            alert("End date should be greater than Start date");
                            document.getElementById("EndDate").value = "";
                        }
                    });
                </script>
<!--#endregion -->



            </form>
        </div>
    </div>
</div>