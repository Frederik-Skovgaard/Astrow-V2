@page "{handler?}"
@model Astrow_2._0.Pages.AdminPage.UpdateTimeCardModel
@{
    ViewData["Title"] = "Timekort | Page";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}



<form asp-page-handler="User" method="post">
    <div class="AdminPage">
        <button class="AdminNavBTN" id="AdminNavBTN">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
            </svg>
        </button>

        <div class="container">
            <div class="AdminNav">
                <div class="row upper-row" id="AdminNav">
                    <a href="/AdminPage/Opret-Bruger" class="btn btn-lg btn-secondary">
                        <i class="fas fa-plus-circle"></i> Opret bruger
                    </a>
                    <a href="/AdminPage/Opdater-Bruger" class="btn btn-lg btn-secondary">
                        <i class="fas fa-user-edit"></i> Opdater bruger
                    </a>
                    <a href="/AdminPage/Opdater-Timekort" class="btn btn-lg btn-primary">
                        <i class="fas fa-user-clock"></i> Opdater Timekort
                    </a>
                    <a href="/AdminPage/Brugere" class="btn btn-lg btn-secondary">
                        <i class="fas fa-users"></i> Brugere
                    </a>
                    <a href="/AdminPage/Fraværes-Anmodninger" class="btn btn-lg btn-secondary bottom">
                        <i class="fa-solid fa-calendar-day"></i> Anmodniger
                    </a>
                </div>
            </div>
            <div class="container lower-container OpdateTimeCard">
                <div class="row col-row">
                    <div class="col-3 UserTimeUpdate">
                        <label>User</label> <br />
                        <div class="dropdown">
                            <button class="btn btn-p dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                Users
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                @foreach (Model.Containers.Users user in Model.UserList)
                                {
                                    @*Dropdown with every user*@
                                    <form asp-page-handler="User" method="post">
                                        <input asp-for="ID" value="@user.User_ID" hidden />
                                        <input class="dropdown-item" type="submit" asp-page-handler="User" id="usernbtn" value="@user.UserName" />
                                    </form>
                                }
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row col-row">
                    <div class="row col-6 DateTimeUpdate">
                        <label>Date</label> <br />

                        @if (Model.DateBool == true)
                        {
                            <input id="Calendar" value="@Model.CalenderValue" type="date" name="Calendar" class="form-control" min="@Model.StartDay" max="@Model.EndDay" oninvalid="this.setCustomValidity('Vælge en dato')" oninput="this.setCustomValidity('')" required />
                            <input type="submit" asp-page-handler="Load" id="SubmitBTN" value="Choose" class="btn btn-primary" style="width: min-content;" />
                        }
                        else
                        {
                            <input id="Calendar" value="@Model.CalenderValue" type="date" name="Calendar" class="form-control" min="@Model.StartDay" max="@Model.EndDay" oninvalid="this.setCustomValidity('Vælge en dato')" oninput="this.setCustomValidity('')" required disabled />
                            <input type="submit" asp-page-handler="Load" id="SubmitBTN" value="Choose" class="btn btn-primary" style="width: min-content;" disabled />
                        }
                    </div>

                </div>


                @if (Model.TimeBool == true)
                {
                    <div class="row col-row">
                        <div class="row col-6 OpdaterTimeCardRow">
                            <label>Start dag tid</label> <br />
                            <input class="HourClock" type="time" name="StartHour" value="@Model.StartHour" asp-for="StartHour">
                        </div>


                        <div class="row col-6 OpdaterTimeCardRow">
                            <label>Slut dag tid</label> <br />
                            <input class="HourClock" id="HourClock" type="time" name="EndHour" value="@Model.EndHour" asp-for="EndHour">
                        </div>
                    </div>
                }
                else
                {
                    <div class="row col-row">
                        <div class="row col-6 OpdaterTimeCardRow">
                            <label>Start dag tid</label> <br />
                            <input class="HourClock" type="time" name="StartHour" value="@Model.StartHour" asp-for="StartHour" disabled>
                        </div>


                        <div class="row col-6 OpdaterTimeCardRow">
                            <label>Slut dag tid</label> <br />
                            <input class="HourClock" id="HourClock" type="time" name="EndHour" value="@Model.EndHour" asp-for="EndHour" disabled>
                        </div>
                    </div>
                }


                <div class="row col-row">
                    <div class="row col-12 OpdaterTimeCardRow">
                        <p class="AbOptions" id="AbOptions" style="font-size: 20px;">+</p>
                        <p class="AbOptions"> Absence</p>

                        <div class="AbsenceOptions">
                            <div class="AbsHide AbsHidden">
                                <label>Fravær Grund</label> <br />
                                @if (Model.TimeBool == true)
                                {
                                    <textarea type="text" class="form-control AbsenceText" name="AbscenseText" value="@Model.AbscenseText" asp-for="AbscenseText"></textarea>
                                }
                                else
                                {
                                    <textarea type="text" class="form-control AbsenceText" name="AbscenseText" value="@Model.AbscenseText" asp-for="AbscenseText" disabled></textarea>
                                }

                                @if (Model.TimeBool == true)
                                {
                                    <select asp-for="AbsenceTypeStr" class="form-control AbscenseTypeDrop" name="AbsenceType" asp-for="AbsenceType" id="AbscenseDrop">
                                        @{
                                            foreach (Model.Items.AbscenseType type in Model.Abscenses)
                                            {
                                                <option value="@type.ID">@type.Type</option>
                                            }
                                        }
                                    </select>
                                }
                                else
                                {
                                    <select class="form-control AbscenseTypeDrop" name="AbsenceType" asp-for="AbsenceType" id="AbscenseDrop" disabled></select>
                                }
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row submit-row">
                    @if (Model.TimeBool == true)
                    {
                        <input value="Submit" id="SubmitButton" type="submit" asp-page-handler="Submit" class="btn btn-lg btn-primary" />
                    }
                    else
                    {
                        <input value="Submit" id="SubmitButton" type="submit" asp-page-handler="Submit" class="btn btn-lg btn-primary" disabled />
                    }

                </div>

            </div>
        </div>
    </div>

    <script type="text/javascript">
        $('#SubmitBTN').click(function(){
            document.getElementById('SubmitButton').disabled = false;
            document.getElementById('HourClock').disabled = false;
            document.getElementById('Calendar').disabled = false;
            document.getElementById('SubmitBTN').disabled = false;
        });

        $('.AbOptions').click(function() {

            if(document.getElementById('AbOptions').innerText == "-")
            {
                document.getElementById('AbOptions').innerText = "+";
                $('#AbOptions').toggleClass("Minnus");
                $('.AbsHide').toggleClass('AbsHidden');
            }
            else
            {
                document.getElementById('AbOptions').innerText = "-";
                $('#AbOptions').toggleClass("Minnus");
                $('.AbsHide').toggleClass('AbsHidden');
            }
        });

        $('#SubmitButton').click(function() {
            alert('Dagen blev opdateret');
            window.location.href='/AdminPage/Opdater-Bruger';
        });


        //Make Admin Nav apper and disapper, Magic!
        $('#AdminNavBTN').click(function() {
            $('#AdminNav').toggleClass("show")
        });
    </script>
</form>

<form method="post">
    <!--#region FraværesAnmodning  -->
    <!-- Modal -->
    <div class="modal fade" id="AbscenseRequest" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Fraværsanmodning</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row col-row">
                        <div class="col-6 Abscense">
                            <select class="form-control AbscenseTypeDrop" asp-for="AbsenceType" name="AbsenceType" id="AbscenseDrop">
                                @{
                                    foreach (Model.Items.AbscenseType type in Model.AbscensesRequest)
                                    {
                                        <option value="@type.ID">@type.Type</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="row col-row TextRow">
                        <div class="col-6 TextCol">
                            <textarea type="text" class="form-control AbsenceText" name="AbscText" placeholder="* Valgfrit Fraværes oversag" asp-for="AbscText"></textarea>
                        </div>
                    </div>
                    <div class="row col-row Date" id="Date">
                        <div class="col-6 Calendar">
                            <input id="AbsCalendar" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCal" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Vælge en dato')" oninput="this.setCustomValidity('')" required />
                        </div>
                        <div class="col-2 Hour">
                            <input class="HourClock" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="Hour" required>
                        </div>
                    </div>
                    <div class="TwoDates" id="TwoDatesDiv">
                        <div class="row col-row Date">
                            <div class="col-6">
                                <input id="AbsCalendarTwo" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalTwo" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv start dato her')" oninput="this.setCustomValidity('')" />
                            </div>
                            <div class="col-6">
                                <input id="AbsCalendarThree" value="@DateTime.Now.ToString("yyyy/MM/dd")" type="date" name="AbsCalThree" class="form-control" min="@DateTime.Now.ToString("yyyy/MM/dd")" oninvalid="this.setCustomValidity('Skriv end dato her')" oninput="this.setCustomValidity('')" />
                            </div>
                        </div>
                        <div class="row col-row Clock">
                            <div class="col-6 TwoDate">
                                <input class="HourClockTwo" id="HourTwo" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="HourTwo">
                            </div>
                            <div class="col-6 TwoDate">
                                <input class="HourClockTwo" id="HourThree" value="@DateTime.Now.ToString("HH:mm")" min="08:00" max="15:24" type="time" name="HourThree">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input value="1" id="Bit" asp-for="Bit" hidden />
                    <input type="button" id="TwoDates" class="btn btn-secondary" value="Længer period" />
                    <input type="button" class="btn btn-secondary" data-dismiss="modal" value="Close" />
                    <input type="submit" id="submit" class="btn btn-primary" asp-page-handler="AbscenseRequest" value="Save changes" />
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
       $('#TwoDates').click(function() {
            $('.TwoDates').toggleClass("show");
            $('#Date').toggleClass("Hide");

            if (document.getElementById('AbsCalendar').hasAttribute("Required")) {
                document.getElementById('Bit').setAttribute('value','2')

                $('#AbsCalendar').prop('required',false);
                $('#HourClock').prop('required',false);

                $('#AbsCalendarTwo').prop('required',true);
                $('#AbsCalendarThree').prop('required',true);
                $('#HourTwo').prop('required',true);
                 $('#HourTwo').attr('min', '8');

                $('#HourThree').prop('required',true);
                $('#HourThree').attr('min', '8');
            }
            else {
                document.getElementById('Bit').setAttribute('value','1')

                $('#AbsCalendar').prop('required',true);
                $('#HourClock').prop('required',true);

                $('#AbsCalendarTwo').prop('required',false);
                $('#AbsCalendarThree').prop('required',false);

                $('#HourTwo').prop('required',false);
                $('#HourTwo').removeAttr('min');

                $('#HourThree').prop('required',false);
                $('#HourThree').removeAttr('min');
            }
        });

        $('#submit').click(function() {
            if (document.getElementById('AbscenseRequest').classList.contains("show")) {

                $('#FirstName').prop('required',false);
                $('#LastName').prop('required',false);
                $('#UserName').prop('required',false);
                $('#Password').prop('required',false);
                $('#StartDate').prop('required',false);
                $('#EndDate').prop('required',false);

                
            }
            else {

                $('#FirstName').prop('required',true);
                $('#LastName').prop('required',true);
                $('#UserName').prop('required',true);
                $('#Password').prop('required',true);
                $('#StartDate').prop('required',true);
                $('#EndDate').prop('required',true);
            }
    });

        document.getElementById('AbsCalendarTwo').onchange = function () {
            var input = document.getElementById('AbsCalendarThree');
            var otherInput = document.getElementById('AbsCalendarTwo').value;
            input.setAttribute("min", otherInput)
        }

        $('#submit').click(function () {
            if (document.getElementById('TwoDatesDiv').classList.contains("show")) {
                 var currentStartTimeValue = document.getElementById("HourTwo").value;
                 var currentEndTimeValue = document.getElementById("HourThree").value;

                 if (!currentStartTimeValue) {
                     alert('Vægle en start tid!');
                         return false;
                 }
                 else if (!currentEndTimeValue) {
                     alert('Vægle en slut tid!');
                         return false;
                 }
                 else if (currentStartTimeValue >= currentEndTimeValue || currentStartDateValue > currentEndDateValue) {
                            if(currentStartDateValue >= currentEndDateValue) {
                                alert('Slut tiden må ikke være før start tiden!');
                                return false;
                            }
                 }

                 document.getElementById('submit').style.pointerEvents = "none";

            }
        });

        $("#EndDate").change(function () {
            var startDate = document.getElementById("StartDate").value;
            var endDate = document.getElementById("EndDate").value;

            if ((Date.parse(endDate) <= Date.parse(startDate))) {
                alert("End date should be greater than Start date");
                document.getElementById("EndDate").value = "";
            }
        });
    </script>
    <!--#endregion -->
</form>
